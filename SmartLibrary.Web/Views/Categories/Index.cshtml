@model IEnumerable<Category>
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery antiforgery
@{
    ViewData["Title"] = "Categories";
}
<div class="card shadow-sm">
    <div class="card-header">
        <h3 class="card-title">
            <div class="symbol symbol-40px me-4">
                <div class="symbol-label fs-2 fw-semibold text-success">
                    <!--begin::Svg Icon | path: icons/duotune/general/gen002.svg-->
                    <span class="svg-icon svg-icon-2 svg-icon-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stack" viewBox="0 0 16 16">
                            <path d="m14.12 10.163 1.715.858c.22.11.22.424 0 .534L8.267 15.34a.6.6 0 0 1-.534 0L.165 11.555a.299.299 0 0 1 0-.534l1.716-.858 5.317 2.659c.505.252 1.1.252 1.604 0l5.317-2.66zM7.733.063a.6.6 0 0 1 .534 0l7.568 3.784a.3.3 0 0 1 0 .535L8.267 8.165a.6.6 0 0 1-.534 0L.165 4.382a.299.299 0 0 1 0-.535z" />
                            <path d="m14.12 6.576 1.715.858c.22.11.22.424 0 .534l-7.568 3.784a.6.6 0 0 1-.534 0L.165 7.968a.299.299 0 0 1 0-.534l1.716-.858 5.317 2.659c.505.252 1.1.252 1.604 0z" />
                        </svg>

                    </span>
                    <!--end::Svg Icon-->
                </div>
            </div>
            Categories
        </h3>
        <div class="card-toolbar">
            <a href="javascript:;" class="btn btn-sm btn-primary d-flex align-items-center js-render-modal"
                                                 data-title="Add Category" data-url="/Categories/Create">
                <i class="bi bi-plus-square-dotted"></i>
                Add
            </a>
        </div>
    </div>
    <div class="card-body">
        @if (!Model.Any())
        {
            <div class="alert alert-dismissible bg-light-warning border border-warning border-dashed d-flex flex-column flex-sm-row w-100 p-5 mb-10">
                <!--begin::Icon-->
                <i class="ki-duotone ki-message-text-2 fs-2hx text-warning me-4 mb-5 mb-sm-0 bi bi-exclamation-circle-fill"></i>

                <!--end::Icon-->
                <!--begin::Content-->
                <div class="d-flex flex-column pe-0 pe-sm-10 align-self-center">
                    <h5 class="mb-1">No Categories Found !</h5>
                </div>
                <!--end::Content-->
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-row-dashed table-row-gray-300 gy-7">
                    <thead>
                        <tr class="fw-bold fs-6 text-gray-800">
                            <th>Name</th>
                            <th>Status</th>
                            <th>Created On</th>
                            <th>Last Updated On</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var category in Model)
                        {
                           <partial name="_CategoryRow" model="@category"/>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>

<input type="hidden" name="__RequestVerificationToken" value="@antiforgery.GetAndStoreTokens(Context).RequestToken" />
@* @Html.AntiForgeryToken() *@
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
       
        // function ToggleStatus(categoryId){
        //         console.log(categoryId);
        //         $.ajax({
        //                 url:"/Categories/ToggleStatus/" + categoryId,
        //                 method: 'POST'

        //         });
        // }

        $(document).ready(function(){
            $('body').delegate('.js-toggle-status' ,'click', function(){
                // console.log("Button Clicked");
                var btn = $(this);
                // console.log(btn.data('id'));
                // var result = confirm("Are you Sure that you need to toggle this item status?");

                bootbox.confirm({
                    message: 'Are you Sure that you need to toggle this item status?',
                    buttons: {
                        confirm: {
                            label: 'Yes',
                            className: 'btn-danger'
                        },
                        cancel: {
                            label: 'No',
                            className: 'btn-secondary'
                        }
                    },
                    callback: function (result) {
                        if(result){
                            $.post({
                                url:"/Categories/ToggleStatus/" + btn.data('id'),
                                data:{
                                    '__RequestVerificationToken':$('input[name = "__RequestVerificationToken"]').val()

                                },
                                success: function(LastUpdatedOn){
                                    // js-update-on
                                    var row = btn.parents('tr');
                                    var status = row.find('.js-status');
                                    var newStatus = status.text().trim() === "Deleted"? "Available" : "Deleted";
                                    status.text(newStatus).toggleClass('badge-light-success badge-light-danger');
                                    row.find('.js-update-on').html(LastUpdatedOn);
                                    row.addClass('animate__animated animate__flash');

                                    ShowSuccessMessage();

                                },
                                error: function(){
                                    ShowErrorMessage();

                                }
                            });
                        }
                    }
                });
               




            });
        });



    </script>
}